<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Background Image segmentation is frequently used in digital image processing and analysis to divide a digital image into a number of regions of pixels, usually based on the properties of the pixels in the image."><title>NDWI Segmentation Threshold in Image Processing</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://thdngan.github.io/quartz//icon.png><link href=https://thdngan.github.io/quartz/styles.454b70f0e2c2393302994bfa82e25b54.min.css rel=stylesheet><link href=https://thdngan.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://thdngan.github.io/quartz/js/darkmode.eb8b060bbe578aaa5e3cfad26da483e6.min.js></script>
<script src=https://thdngan.github.io/quartz/js/util.39f53d45cb9520bdaf946bd063598b19.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://thdngan.github.io/quartz/js/popover.37b1455b8f0603154072b9467132c659.min.js></script>
<script src=https://thdngan.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://thdngan.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://thdngan.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const isReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,lastVisit=localStorage.getItem("lastVisitTime"),now=Date.now();let show="true";if(lastVisit){document.documentElement.setAttribute("visited","true");const e=Math.ceil((now-parseInt(lastVisit))/(1e3*60));show=!isReducedMotion&&e>5?"true":"false"}document.documentElement.setAttribute("show-animation",show),localStorage.setItem("lastVisitTime",`${now}`);const BASE_URL="https://thdngan.github.io/quartz/",fetchData=Promise.all([fetch("https://thdngan.github.io/quartz/indices/linkIndex.7d7e6e07aa25a98a977c108e1ea66053.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://thdngan.github.io/quartz/indices/contentIndex.180afaa93a2dea2a3ab3c4ae9da71fb5.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL(BASE_URL),s=n.pathname,o=window.location.pathname,i=s==o;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts();const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!0;drawGraph("https://thdngan.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://thdngan.github.io/quartz",!0,!0)},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/thdngan.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://thdngan.github.io/quartz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header class="delay t-3"><h1 id=page-title><a href=https://thdngan.github.io/quartz/>The Arboretum</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>NDWI Segmentation Threshold in Image Processing</h1><p class=meta>Last updated
Nov 1, 2022</p><ul class=tags><li><a href=https://thdngan.github.io/quartz/tags/image-processing/>Image processing</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><ol><li><a href=#digital-number-dn>Digital Number (DN)</a></li><li><a href=#top-of-atmosphere-toa>Top of Atmosphere (TOA)</a></li><li><a href=#ndvi-and-ndwi>NDVI and NDWI</a></li></ol></li></ol></nav></details></aside><a href=#background><h1 id=background><span class=hanchor arialabel=Anchor># </span>Background</h1></a><p>Image segmentation is frequently used in digital image processing and analysis to divide a digital image into a number of regions of pixels, usually based on the properties of the pixels in the image. For instance, picture segmentation might be used to distinguish between the foreground and background or to group together clusters of pixels that have a common color or shape.</p><p>Thresholding is a method that refers to a common approach of finding similarities between regions of an image. Here, we alter an image&rsquo;s pixel characteristics to make it simpler to analyze. We turn a grayscale or RGB image into a binary image (only black and white, for example). Thresholding allows us to select the areas of an image that are of interest while disregarding the other parts. For instance, using a satellite image, this technique may be used to identify areas of surface water! Isn&rsquo;t it interesting how we can separate and highlight water regions on a planet from satellite images? In this post, I&rsquo;ll give a brief overview of the principles and how ENVI and MATLAB can be used to implement it.</p><a href=#principles><h1 id=principles><span class=hanchor arialabel=Anchor># </span>Principles</h1></a><p>There are a few important concepts for segmentation thresholding using NDWI/NDVI.</p><a href=#digital-number-dn><h3 id=digital-number-dn><span class=hanchor arialabel=Anchor># </span>Digital Number (DN)</h3></a><p>A digital image is a matrix made of pixels (picture elements). Each pixel is filled by an integer called a digital number. The digital number represents the radiance of the light measured for the pixel, and it is proportional to the radiance. A 256x256 <a href=/quartz/posts/sampling-and-quantization rel=noopener class=internal-link data-src=/quartz/posts/sampling-and-quantization>spatial domain</a> image, for example, has 256 x 256 = 65,536 pixels, whereas a 1024x1280 image has 1,310,720 pixels. The value of each pixel in grayscale images is related to the amount of bits of data used to represent the pixel (typically 8 bits), ranging from 0 to 255 (2<sup>8</sup> = 256 grayscale levels created from combinations of 8 binary numbers: 00000000 to 11111111). If a pixel&rsquo;s value is represented by 16 bits, the value range is 0 to 65,535 (2<sup>16</sup> = 65,536 grayscale levels).</p><p><img src="/quartz/images/image processing/qinghai landsat b3.png" width=auto></p><p align=center><i>LANDSAT 8-9 image of Qinghai Lake (China) in the visible green band (Band 3)</i></p>You can have a look at the properties of this image using QGIS or many other applications.<p><img src="/quartz/images/image processing/qinghai landsat b3 properties.png" width=auto></p><p>So this is a 16-bit image, which means the value range of each pixel would be from 0 to 65,535, representing the intensity of visible green light. For this particular image, the minimum value of a pixel is 4 (not completely &ldquo;black&rdquo;) and the maximum value is 65,454.</p><p>If you open this image in ENVI and access the cursor value, the number for data is the digital number of the pixel where your cursor is hovering.
<img src="/quartz/images/image processing/digital number data value envi.png" width=auto></p><p align=center><i>Here, my cursor is pointing at a pixel with a digital number of 8267</i></p>Digital numbers correspond to the energy detected and measured at the sensor. They are connected to surface reflectance values, but they are NOT the same! Using DNs collected by satellite without adjusting for atmospheric effects as light passes through the atmosphere may result in many problems!<p>Then what do we use instead?</p><a href=#top-of-atmosphere-toa><h3 id=top-of-atmosphere-toa><span class=hanchor arialabel=Anchor># </span>Top of Atmosphere (TOA)</h3></a><p>Remote sensing tools directly measure radiance. This includes radiation reflected from the surface, as well as radiation reflected from nearby pixels, and perhaps most significantly, radiation reflected from clouds! Furthermore, radiance is affected not only by the intensity and direction of the target&rsquo;s illumination, but also by its orientation and position.</p><p><em>Read more about the energy transfer in the atmosphere through my posts on <a href=/quartz/subjects/climatenweather rel=noopener class=internal-link data-src=/quartz/subjects/climatenweather>climate and weather</a></em></p><p><img src="/quartz/images/image processing/reflectance through atmosphere.png" width=auto></p><p><img src="/quartz/images/image processing/diffuse_v_specular.png" width=auto></p><p>In other words, the travel of light in the atmosphere is influenced by a variety of elements as it goes down to the Earth through the atmosphere, diffusively reflects off the Earth&rsquo;s surface, and then returns up through the atmosphere, suffering from scattering effects. Thus, instead of the digital number, we would determine the Top of Atmosphere (TOA) reflectance values, which can be estimated mainly from radiance leaving the ground, transmission factors and path radiance.</p><p>Reflectance values range from 0 to 1 and are stored in floating point data format. With ENVI, you can easily convert Landsat optical band data from the USGS in the &ldquo;USGS GeoTIFF with Metadata&rdquo; format to TOA reflectance values when you open the USGS file that ends with &ldquo;MLT.TXT&rdquo;. More details can be found in Section 1 of
<a href="https://yceo.yale.edu/how-convert-landsat-dns-top-atmosphere-toa-reflectance?fbclid=IwAR0UbHmDqOGd6FrrCxYh7CcCTHtwFZ7u6wJhEyMscWnD3wUHrUHSWIYjFVo" rel=noopener>this page</a>.</p><p>The metadata file &ldquo;MLT.TXT&rdquo; provides rescaling factors and parameters that can be used to manually convert Landsat data to TOA reflectance with the following formula, using the tool <strong>Band Math</strong>.</p><p>$$\rho_\lambda = \dfrac{M_\rho Q_{cal}+A_\rho}{cos(\theta_{SZ})} = \dfrac{M_\rho Q_{cal}+A_\rho}{sin(\theta_{SE})}$$
where:</p><ul><li>$M_\rho$ is the band-specific multiplicative rescaling factor (REFLECTANCE_MULT_BAND_x in the metadata, where x is the band number).</li><li>$A_\rho$ is the band-specific additive rescaling factor (REFLECTANCE_ADD_BAND_x).</li><li>$Q_{cal}$ is the quantized and calibrated standard product pixel values (digital number DN).</li><li>$M_\rho Q_{cal} + A_\rho$ is then the TOA planetary reflectance without correction for solar angle.</li><li>$\theta_{SE}$ is the local sun elevation angle (SUN_ELEVATION)</li><li>$\theta_{SZ}$ is the local solar zenith angle; $\theta_{SZ}=90\degree-\theta_{SE}$</li></ul><p>And below is the result I got after converting from DN to TOA. You can see that the cursor value for data has changed. Its range (originally 0 to 65,535) is now from -1 to 1.</p><p><img src="/quartz/images/image processing/qinghai landsat TOA b3.png" width=auto></p><a href=#ndvi-and-ndwi><h3 id=ndvi-and-ndwi><span class=hanchor arialabel=Anchor># </span>NDVI and NDWI</h3></a><p>NDVI stands for Normalized Difference Vegetation Index and NDWI stands for Normalized Difference Water Index.</p><p>NDVI is used to quantify vegetation greenness and is useful in understanding vegetation density. Vegetation is quantified by measuring the difference between near-infrared (which vegetation strongly reflects) and red light (which vegetation absorbs).</p><p>$$NDVI = \dfrac{NIR - Red}{NIR+Red}$$</p><p>On the other hand, NDWI is used to monitor changes related to water content in water bodies. As water bodies strongly absorb light in visible to infrared electromagnetic spectrum, NDWI uses green and near-infrared bands to hightlight water bodies.</p><p>$$NDWI = \dfrac{Green - NIR}{Green +NIR}$$</p><p><img src="/quartz/images/image processing/bands_reflectance.png" width=auto></p><p>From the above figure, it is apparent that reflection in <strong>NIR</strong> wavelength over water bodies is <strong>lower</strong> than reflection in the <strong>Red</strong> wavelength. As a result, <strong>water bodies</strong> will have <em><strong>negative NDVI</strong></em> values. On the contrary, reflection in <strong>Green</strong> wavelength over water bodies is <strong>higher</strong> than reflection in <strong>NIR</strong> wavelength. Thus, <strong>water bodies</strong> will have <em><strong>positive NDWI</strong></em> values.</p><p>For Landsat 8, band 3 represents visible green light, band 4 represents visible red light and the near-infrared is shown in band 5. Therefore, for Landsat 8 data, we can calculate the NDVI and NDWI like below:</p><p>$$NDVI = \dfrac{B5-B4}{B5+B4}$$
$$NDWI = \dfrac{B3-B5}{B3+B5}$$
Using the NDVI tool on a layerstacked image (for example, layerstacking band 3 and band 5 to calculate NDWI), we can obtain the following result:</p><p><img src="/quartz/images/image processing/qinghai landsat ndwi35 water.png" width=auto></p><p align=center><i>The cursor is hovering over Qinghai lake so we have positive NDWI value (I imported the NDWI file into the blue band)</i></p><img src="/quartz/images/image processing/qinghai landsat ndwi35 nonwater.png" width=auto><p align=center><i>The cursor is hovering over non-water area so we have negative NDWI value</i></p>And now we're almost done with the processes using ENVI! For further processing in MATLAB, we need to convert the map projection from UTM to **Geographic Lat/Lon**, using **Map| Convert Map Projection**, and then save the file as TIFF/GeoTIFF.<p>I will write another post for detailed explanation on the MATLAB scripts for extracting water bodies from the NDWI image obtained, and also removing cloud-covered pixels using the BQA file.</p><p><img src="/quartz/images/image processing/Histogram_NDWI.jpg" width=auto></p><p><img src="/quartz/images/image processing/NDWI_LANDSAT.jpg" width=auto></p><p><img src="/quartz/images/image processing/Surface_Water_LANDSAT_NDWI.jpg" width=auto></p></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph <i>(drag and click)</i></h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://thdngan.github.io/quartz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Ryan using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=https://thdngan.github.io/quartz/>Home</a></li><li><a href=https://www.instagram.com/astrosw1113/>Instagram</a></li><li><a href=https://github.com/thdngan/>Github</a></li></ul></footer></div></div></body></html>